# 限流

### 令牌桶算法
令牌桶算法主要用于限制流量的平均流入速率，并且还允许出现一定程度上的突发流量。

令牌桶算法限流的基本流程:

* 每秒会有r个令牌被放入桶内，也就是说，会以1/r秒的平均速率向桶中依次放入令牌
(比如每秒共放入10个令牌，那么每0.1秒放入1个令牌)
* 桶的容量是固定不变的，假设桶中最多只允许存放b个令牌，如果桶满了再放入令牌，则溢出(新添加的令牌被丢弃)
* 当一个n字节的请求包到达时，将消耗n个令牌，然后再发送该数据包
* 若桶中的可用令牌数小于n，则该数据包将会被执行限流处理。

### 漏桶算法
漏桶算法的基本流程:
* 可以以任何速率向桶中流入水滴。
* 桶的容量是固定不变的，如果桶满了则溢出(新流入的水滴被丢弃)。
* 按照固定速率从桶中流出水滴。

从本质上来说，令牌桶算法和漏桶算法都可以用于在高并发、大流量场景下对
流量实施管制，让系统的负载出于均衡的水位，不会因为峰值流量过大，导致
系统流量被击垮。但是需要注意，这两年算法的限流方向是截然相反的。令牌
桶算法限制的是流量的平均流入率，并且可以允许出现一定程度上的突发流量，
当桶中的令牌数量不足减扣时，新的请求会被执行限流处理；而漏桶算法限制的
是流量的流出率，而不是流入速率，并且这种流出速率还是保持固定不变的，不
允许像令牌桶算法那样出现突发流量，当流入的水滴超过桶的容量的时候，新
的请求江北执行限流处理。